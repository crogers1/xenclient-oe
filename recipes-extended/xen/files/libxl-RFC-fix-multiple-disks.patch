################################################################################
SHORT DESCRIPTION:
################################################################################
Allow stubdomains to have multiple disks. Derive the correct device path.

################################################################################
LONG DESCRIPTION:
################################################################################

################################################################################
CHANGELOG
################################################################################
Derived from original patch by:
Jed Lejosne <lejosnej@ainfosec.com>

################################################################################
REMOVAL
################################################################################

################################################################################
UPSTREAM PLAN
################################################################################
Yes with upstreaming Linux stubdomain support.

################################################################################
INTERNAL DEPENDENCIES
################################################################################
stubdomain RFC patches

################################################################################
PATCHES
################################################################################
--- a/tools/libxl/libxl_dm.c
+++ b/tools/libxl/libxl_dm.c
@@ -1866,6 +1866,14 @@ static int libxl__build_device_model_arg
                              "qemu-xen doesn't support read-only AHCI disk drivers");
                         return ERROR_INVAL;
                     }
+                    if (b_info->stubdomain_version == LIBXL_STUBDOMAIN_VERSION_LINUX) {
+                        target_path = (char *[]) {"/dev/xvda",
+                                                  "/dev/xvdb",
+                                                  "/dev/xvdc",
+                                                  "/dev/xvdd",
+                                                  "/dev/xvde",
+                                                  "/dev/xvdf",} [disk];
+                    }
                     flexarray_vappend(dm_args, "-drive",
                         GCSPRINTF("file=%s,if=none,id=ahcidisk-%d,format=%s,cache=writeback",
                         target_path, disk, format),
